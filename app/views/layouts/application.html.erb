<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head profile="http://gmpg.org/xfn/11">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<% ctrlr = controller.controller_name %>
	<% acn = controller.action_name %>
	<title><%= title(ctrlr,acn)%></title>
  <meta name="description" content="A description of the page must go here." />
  <meta name="keywords" content="keyword1,keyword2,keyword3" />
  <meta name="robots" content="INDEX,FOLLOW" />
  <meta charset="utf-8" />
  <%= csrf_meta_tag %>
	<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico" />
  <%=stylesheet_link_tag "base","modal","scrollbar",'jquery.autocomplete','calender','colorpicker'%>
	<script src="/closure-library/closure/goog/base.js"></script>

  <link rel="stylesheet" href="/closure-library/closure/goog/css/autocomplete.css">
  <script>
    goog.require('goog.dom');
    goog.require('goog.events.KeyCodes');
    goog.require('goog.ui.KeyboardShortcutHandler');
    goog.require('goog.ui.AutoComplete.Basic');
  </script>
		<!--[if lte IE 9]>
		<link rel="stylesheet" type="text/css" href="/styles/ie.css" />
	<![endif]-->
      <%= javascript_include_tag 'jquery-1.4.4.min','jquery-latest','jquery.bgiframe.min','size-container','open','jquery.validate','date', 'colorpicker','eye','utils','jquery.fileupload-ui','jquery.fileupload','json2','application','jquery.autocomplete','jscolor'%>
    <script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.4/underscore-min.js"></script>
    <script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/0.3.3/backbone-min.js"></script>		
    <%= javascript_include_tag :socky %>

	<!--[if lt IE 7]>
	<script src="http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js" type="text/javascript"></script>
	<![endif]-->
	<!--[if IE 6]>
	<script type="text/javascript">
		// Load jQuery if not already loaded
		if (typeof jQuery == 'undefined') {
			document.write('<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></'+'script>');
			var __noconflict = true;
		}
		var IE6UPDATE_OPTIONS = {icons_path: '/scripts/third-party/ieupdate/images/'};
	</script>
	<script src="/scripts/third-party/ieupdate/ie6update.js" type="text/javascript"></script>
	<![endif]-->
 <!--<link rel="shortcut icon" href="/images/favicon.ico" />-->
</head>
<body class="messages">
<%= render :partial=>'/layouts/header'%>
<div class="clear-fix"></div>
<div id="container">
  <%=yield%>
	<div class="clear-fix"></div>
</div>
<div class="sort-by-tooltip message-sort-down" style="display:none;">
	<div class="sort-by-top"></div>
	<ul>
		<li class="sort selected" id="select_date"><span>Date</span></li>
		<li class="sort"><span>Starred</span></li>
		<li class="sort"><span>Unread</span></li>
	</ul>
	<ul>
		<li class="asc-desc"><span class="asc">Ascending</span></li>
		<li class="asc-desc selected" id="select_descending"><span class="desc">Descending</span></li>
	</ul>
</div>
<!-- sort drop down-->
<div class="sort-by-tooltip task-sort-down" style="display:none;">
	<div class="sort-by-top"></div>
	<ul>
		<li class="sort selected sort-task" id="select_task_date"><span class="task-date">Date</span></li>
		<li class="sort sort-task" id="select_task_starred"><span class="star-task">Starred</span></li>
	</ul>
	<ul>
		<li class="asc-desc sort-task selected" id="select_task_ascending"><span class="asc">Ascending</span></li>
		<li class="asc-desc sort-task" id="select_task_descending"><span class="desc">Descending</span></li>
	</ul>
</div>
<div id="add_new_mods" class="modal add-new-modal" style="display:none">
	<div class="modal-top-left"></div>
	<div class="modal-top-center"></div>
	<div class="modal-top-right"></div>
	<div class="modal-body-contain">
		<div class="modal-body">
			<a href="#create_message" class="silver-45 create_message" ><span>Messages</span></a>
			<a href="#add-task" class="silver-45 create_task"><span>Task</span></a>
			<a href="#add-task-list" class="silver-45 create_task_list"><span>Task List</span></a>
			<a href="#create_project" class="silver-45 create_project"><span>Project</span></a>
		</div>
	</div>
	<div class="modal-bottom-left"></div>
	<div class="modal-bottom"></div>
	<div class="modal-bottom-right"></div>
</div>
<div class="keyboard-shortcuts" style="display:none;">
<%= render :partial=>'layouts/keyboard_shortcuts' %>
</div>
<div id="add_new_mod" style="display:none;">
</div>
<%=render "/layouts/name_settings"%>
</body>
<script>
    function showTriggered(event)
		 {
		  if(event.identifier=='ENTER')
      {
					if ($('#add_new_mods').css('display')=="block")
					{
					$('#add_new_mods').css('display','none')
					}
					else
					{
					short_modal('/projects/add_new');	
					}
      }
      if(event.identifier=='GS')
      {
         project_settings();
      }
      if(event.identifier=='GP')
      {
        settings_profile();
      }
      if(event.identifier=='Q')
      {
        short_modal2('/messages');
      }
			if(event.identifier=='W')
      {
        short_modal2('/tasks');
      }
			if(event.identifier=='E')
      {
        short_modal2('/chats');
      }
      if(event.identifier=='SHIFT_M')
      {
        short_modal1('/messages/new');
      }
      if(event.identifier=='ESC')
      {
			//  short_modal('esc');
			 short_modal1('esc');
	    }
      if(event.identifier=='R')
      {
      short_model3();
      }
			if(event.identifier=='U')
			{
			 short_modal4('U');
			}
			if(event.identifier=='SHIFT_D')
			{
			 short_modal4('T');
			}
			if(event.identifier=='DOWN')
			{
			 short_modal_down('down');
			}
			if(event.identifier=='RIGHT')
			{
			short_modal_right();
			}
			if(event.identifier=='UP')
			{
			short_modal_up();
			}
			if(event.identifier=='LEFT')
			{
			short_modal_left();
			}
			if(event.identifier=='Z')
			{
			short_modal_down('Z')
			}
			if(event.identifier=='A')
			{
			short_modal_down('A')
			}
			if(event.identifier=='S')
			{
			short_modal_down('S')
			}
			if(event.identifier=='X')
			{
			short_modal_down('X')
			}
						if(event.identifier=='D')
			{
			short_modal_down('D')
			}
						if(event.identifier=='C')
			{
			short_modal_down('C')
			}
			if(event.identifier=='SHIFT_T')
			{
			short_modal1('/tasks/new');
			}
			if(event.identifier=='SLASH')
			{
			  $('.keyboard-shortcuts').css('display','block');
			}
			if(event.identifier=='SHIFT_SLASH')
			{
			  $('.keyboard-shortcuts').css('display','block');
      }
			if(event.identifier=='ENTER_M')
			{
			if ($('#add_new_mods').css('display')=="block")
				short_modal1('/messages/new');
			}
			if(event.identifier=='ENTER_T')
			{
			if ($('#add_new_mods').css('display')=="block")
				short_modal1('/tasks/new');
			}
						if(event.identifier=='ENTER_L')
			{
				if ($('#add_new_mods').css('display')=="block")
				{
					$('#add_new_mods').css('display','none');
					short_modal1('/task_lists/new');
				}
			}
						if(event.identifier=='ENTER_P')
			{
				if ($('#add_new_mods').css('display')=="block")
				{
					$('#add_new_mods').css('display','none');
					short_modal1('/projects/new');
				}
      }
    }
  var shortcutHandler = new goog.ui.KeyboardShortcutHandler(document);
  var NONE = goog.ui.KeyboardShortcutHandler.Modifiers.NONE;
  var ESC = goog.ui.KeyboardShortcutHandler.Modifiers.ESC;
  var CTRL = goog.ui.KeyboardShortcutHandler.Modifiers.CTRL;
  var SHIFT = goog.ui.KeyboardShortcutHandler.Modifiers.SHIFT;
  var ENTER= goog.ui.KeyboardShortcutHandler.Modifiers.ENTER;
	 var UP= goog.ui.KeyboardShortcutHandler.Modifiers.UP;
	 var DOWN= goog.ui.KeyboardShortcutHandler.Modifiers.DOWN;
	 var LEFT= goog.ui.KeyboardShortcutHandler.Modifiers.LEFT;
	 var RIGHT= goog.ui.KeyboardShortcutHandler.Modifiers.RIGHT;
   var S=  goog.ui.KeyboardShortcutHandler.Modifiers.S;

  shortcutHandler.registerShortcut('ENTER',goog.events.KeyCodes.ENTER);
  shortcutHandler.registerShortcut('ESC',goog.events.KeyCodes.ESC);
  shortcutHandler.registerShortcut('SHIFT_M',goog.events.KeyCodes.M, SHIFT);
	shortcutHandler.registerShortcut('SHIFT_T',goog.events.KeyCodes.T, SHIFT);

	shortcutHandler.registerShortcut('SLASH',goog.events.KeyCodes.SLASH);
	shortcutHandler.registerShortcut('SHIFT_SLASH',goog.events.KeyCodes.SLASH, SHIFT);

	shortcutHandler.registerShortcut('SHIFT_D',goog.events.KeyCodes.D, SHIFT);

	shortcutHandler.registerShortcut('ENTER_M',goog.events.KeyCodes.M, ENTER);
	 shortcutHandler.registerShortcut('ENTER_T',goog.events.KeyCodes.T, ENTER);
	shortcutHandler.registerShortcut('ENTER_P',goog.events.KeyCodes.P, ENTER);
	shortcutHandler.registerShortcut('ENTER_L',goog.events.KeyCodes.L, ENTER);
  shortcutHandler.registerShortcut('Q',goog.events.KeyCodes.Q);
  shortcutHandler.registerShortcut('R',goog.events.KeyCodes.R);
	shortcutHandler.registerShortcut('U',goog.events.KeyCodes.U);

//	shortcutHandler.registerShortcut('T',goog.events.KeyCodes.T);
	shortcutHandler.registerShortcut('E',goog.events.KeyCodes.E);

	shortcutHandler.registerShortcut('A',goog.events.KeyCodes.A);
	shortcutHandler.registerShortcut('Z',goog.events.KeyCodes.Z);
	shortcutHandler.registerShortcut('S',goog.events.KeyCodes.S);
	shortcutHandler.registerShortcut('X',goog.events.KeyCodes.X);
	shortcutHandler.registerShortcut('D',goog.events.KeyCodes.D);
	shortcutHandler.registerShortcut('C',goog.events.KeyCodes.C);
	shortcutHandler.registerShortcut('W',goog.events.KeyCodes.W);
  shortcutHandler.registerShortcut('GS',goog.events.KeyCodes.G, NONE, goog.events.KeyCodes.S);
  shortcutHandler.registerShortcut('GP',goog.events.KeyCodes.G, NONE,goog.events.KeyCodes.P);
  shortcutHandler.registerShortcut('BACK_SPACE', goog.events.KeyCodes.BACKSPACE);
	shortcutHandler.registerShortcut('UP',goog.events.KeyCodes.UP);
	shortcutHandler.registerShortcut('DOWN',goog.events.KeyCodes.DOWN);
	shortcutHandler.registerShortcut('LEFT',goog.events.KeyCodes.LEFT);
	shortcutHandler.registerShortcut('RIGHT',goog.events.KeyCodes.RIGHT);
  goog.events.listen(shortcutHandler,goog.ui.KeyboardShortcutHandler.EventType.SHORTCUT_TRIGGERED,showTriggered);
  $(document).ready(function(){
    $('a.menutext').click(function(){
      path=($(this).attr('href'));
      redirect_short(path);
      return false;
    });
  });
	
	// For the keys A,Z,down,S,X
		function short_modal_down(key)
	{
		location1=window.location.href;
		find_loc=$('#myprofile1').css('display');
		if(find_loc=="block")
		{
		  if(key!="A" && key!="Z")
			profile_navigation_down(key);
		}
		else
		{
		find_loc=$('#general_anchor').css('display');
		if(find_loc=="block")
		{
			settings_navigation_down(key);
		}
		else
		{
		
		find_loc=location1.search(/messages/)
		
		if(find_loc!=-1)
		{
			messages_navigation_down(key);
		}
		else
		{
		find_loc1=location1.search(/chats/);
		
				if(find_loc1!=-1)
				{
		chats_navigation_down(key);
		}
		else
		{
		tasks_navigation_down(key);
		}
		}
		}
		}
	}
	// For right arrow
	function short_modal_right()
	{
		location1=window.location.href;
	find_loc=$('#general_anchor').css('display');
		if(find_loc=="block")
		{
			settings_navigation_right();
		}
		else
		{
		find_loc=location1.search(/messages/);
		if(find_loc!=-1)
		{
			messages_navigation_right();
		}
		else
		{
			tasks_navigation_right();
		}
		}
	}
	
	//for left arrow
	function short_modal_left()
	{
			location1=window.location.href;
	find_loc=$('#general_anchor').css('display');
		if(find_loc=="block")
		{
			settings_navigation_left();
		}
		else
		{
		find_loc=location1.search(/messages/);
		if(find_loc!=-1)
		{
			messages_navigation_left();
		}
				else
		{
			tasks_navigation_left();
		}
		}
	}
	
	// for up arrow
	function short_modal_up()
	{
			location1=window.location.href;
		find_loc=$('#myprofile1').css('display');
		if(find_loc=="block")
		{
			profile_navigation_down('up');
		}
		else
		{
		find_loc=$('#general_anchor').css('display');
		if(find_loc=="block")
		{
			settings_navigation_down('up');
		}
		else
		{
		find_loc=location1.search(/messages/)
		if(find_loc!=-1)
		{
			messages_navigation_down('up');
		}
				else
		{
			find_loc1=location1.search(/chats/);
		
				if(find_loc1!=-1)
				{
		chats_navigation_down('up');
		}
		else
		{
		tasks_navigation_down('up');
		}
		}
		}
		}
	}
	function short_modal(path)  //Add new project/messsage/task/tasclist
  {		
	if (($('#add_new_mod').css('display')=="none") || 	 ($('.add-item-modal').css('display')=="none"))
     $('#add_new_mods').show();
   }
	 function short_modal1(path)  //Add new project/messsage/task/tasclist
	 {
    if (path!='esc')
    {
      $.ajax({
        type :'get',
        url :path,
        success: function(data){
          $('#add_new_mod').html(data);
					$('#add_new_mod').show();
					}
					});
					}
    else
    {
		$('#add_new_mod').hide();
		$('#add_people').hide();
		$('#add_new_mods').hide();
		$('.sort-by-tooltip').hide();
		$('.ds_tbl').hide();
		  $('.keyboard-shortcuts').css('display','none');
		$('.task-dropdown.task_list').hide()
			$('.task-dropdown.assigned-to').hide()
		}
		}
  function short_modal2(path)
  {
		window.location.href=path;
  }
  function settings_profile()
  {
    $.get('/settings-profile', function(data) {
      $('#container').html(data);
    });
    $('.account-dropdown').hide();
		    $('.settings_header').hide();
        $('.task_header').hide();
    $('.sort-by').hide();
     $('body').attr('class','settings');
     document.title="Settings | Mocha"
  }
  function project_settings(){
    $.get('/settings', function(data) {
      $('#container').html(data);
    });
    $('.message_header').hide();
		    $('.task_header').hide();
    $('body').attr('class','settings');
    $('.sort-by').hide();
    document.title="Settings | Mocha"
  }
  function short_model3()
  {
if(($('#reply_comment').parent('li.message_header').css('display')=="list-item" && ($('#reply_comment').css('display')=="block")) )
{
     if ($('.comment-contain').css('display')=="none")
      {
      $('.comment-contain').show();
      }
      else
      {
      $('.comment-contain').hide();
      }
}
  //    $('.comment-contain').slideToggle('slow');
else if(($('#reply_comment_task').parent('li.task_header').css('display')=="list-item" && ($('#reply_comment_task').css('display')=="block")) )
{
     if ($('.comment-contain').css('display')=="none")
      {
      $('.comment-contain').show();
      }
      else
      {
      $('.comment-contain').hide();
      }
}
//$('.comment-contain').slideToggle('slow');
			 $('.attachment').remove();	
  }

	function short_modal4(key)
	{
	var a=$('#submsg').css('display');
	var location1=window.location.href;
	var cpage="task";
	var find_loc=location1.search(/messages/);
	
	if(find_loc!=-1)
	{
	cpage="message";
	}
	if(a=="inline")
	{
	if(key=="U")
	{
	if($('.subscribers').children().hasClass('task-subscribe'))
$('.task-subscribe').click();
else
$('#submsg').click();
		}
		else
		{
		  delete_message();
		}
		
		}
		else
		{
				if(($('#reply_comment_task').parent('li.task_header').css('display')=="list-item" && ($('#reply_comment_task').css('display')=="block")) )

		{
		
		if(key=="T")
		{
		
		  var yes=confirm('Are you sure?');
  var task_id=$('div.message-body').children('span.tsk-det').attr('id').split('tk:')[1];
  if(yes)
  {
   // var task_id=get_task_id();
    $('.task.tsem.open').remove();
    $.ajax({
      url:'/tasks/'+task_id,
      type:'delete'
    });
  }
  return false;
	}
	else if(key=="U")
	{
	 if($('.subscribers').children().hasClass('task-subscribe'))
$('.task-subscribe').click();
else
$('#submsg').click();
	}
		}
		}
	}
		
		
		//for settings page navigation
		function settings_navigation_down(key)
		{
		if(key=="D" || key=="C")
		{
		}
		else
		{
			second_panel=$('#settings_secondpanel').css('visibility');
			people=$('#settings_people').css('display');
			general=$('#settings_general').css('display');
			if((people=="block" || general=="block") && ((key=="down" || key=="up") ||( key=="S" || key=="X")))
			{
				// for second panel navgation
				people=$('#settings_people').css('display');
				general=$('#settings_general').css('display');
				if(people=="none" && general=="none")
				{
					settings_thirdpanel('general');
				}
				else if((people=="none") && (key=="down" || key=="X"))
				{
					settings_thirdpanel('people');
				}
				else if(key=="up" || key=="S")
				{
					settings_thirdpanel('general');
				}
			}
			else
			{
				//first_panel_navigation
				if(key=="S" || key=="X")
				{
				 settings_navigation_right();
				}
				else
				{
				var active_length=$('#active_projects').children('').length;
				var length=$('.projects-list').children("").length;
				already_exists="false";
				for(i=0; i<length; i++)
				{
					classopen=$('.projects-list').children("")[i].className;
					if(classopen=="project has-unread open" || classopen=="project open")
					{
					if((key=="down" || key=="Z") && (i==length-1))
					 $('#completed_list').hide();
					 else if((key=="up" || key=="A") && (i==0))
					 $('#completed_list').show();
					 else if((key=="down" || key=="Z") && (i >= active_length-1))
					 $('#completed_list').show();
					 else if((key=="up" || key=="A") && (i == active_length))
					 $('#completed_list').hide();
					 if((key=="down" || key=="Z") && (i==length-1))
					 var lrdssdsdeady_exists=$('.projects-list').children("")[0].id;
						else if((key=="up" || key=="A") && (i==0))
						var lready_exists=$('.projects-list').children("")[length-1].id;
						else
						if(key=="down" || key=="Z")
						already_exists=$('.projects-list').children("")[i+1].id;
						else
						already_exists=$('.projects-list').children("")[i-1].id;
					}
				}
				if(already_exists=="false")
				{
					//	first_item=$('.projects-list').children("")[0].id;
						id=first_item.split('_');
						id=id[id.length-1];
						settings_secondpanel(id);
				}
				else
				{
				
				id=already_exists.split('_');
						id=id[id.length-1];
						settings_secondpanel(id);
				}
			}
		}
		}
		}
		//for settings page navigation for right arrow
		function settings_navigation_right()
		{
			second_panel=$('#settings_secondpanel').css('display');
		  if(second_panel=="block")
			{
	 			people=$('#settings_people').css('display');
				general=$('#settings_general').css('display');
				if(people=="none" && general=="none")
				{
					settings_thirdpanel('general');
				}
				else if(people=="none")
				{
				settings_thirdpanel('people');
				}
				else
				{
				settings_thirdpanel('general');
				}
			}
		}
		
		//for settings page navigation for left arrow
		function settings_navigation_left()
		{
			people=$('#settings_people').css('display');
			general=$('#settings_general').css('display');
			if(people=="block" || general=="block")
			{
				$('#settings_people').hide();
				$('#settings_general').hide();
				document.getElementById('people_anchor').className="m-tab alt";
				document.getElementById('general_anchor').className="m-tab alt";
			}
		}
		
		// for profile page navigation
		function profile_navigation_down(key)
		{
		
		if(key =="D" || key =="C")
		{
		
		}
		else
		{
			profile=$('#my_profile').css('display');
			contacts=$('#my_contacts').css('display');
				if(profile=="none" && contacts=="none")
				{
					 $('#mycontact1').toggleClass('open')
        $('#my_profile').show();
        $('#myprofile1').toggleClass('open')
        $('#my_contacts').hide();
				}
				else if((profile=="none") && (key=="up" || key=="S"))
				{
									 $('#mycontact1').toggleClass('open')
        $('#my_profile').show();
        $('#myprofile1').toggleClass('open')
        $('#my_contacts').hide();
				}
				else if((contacts=="none") && (key=="down" || key=="X"))
				{
$('#mycontact1').toggleClass('open')
        $('#my_profile').hide();
        $('#myprofile1').toggleClass('open')
        $('#my_contacts').show();
        $('#people_settings_popup').show();
				}
				}
		}
	
		// for messages page navigation
		function messages_navigation_down(key)
		{
		class1=$('#comment_area').children('').length;
		class_hide=$('#comment_area').css('display');
		
		if((class1==0 || class_hide=="none") || (key=="Z" || key=="A"))
		{
			//first panel
			if (key=="S" || key=="X")
			{
			setTimeout("messages_navigation_right()", 1500);
				
			}
			else
			{
			messages_navigation_left();
			var all_messages=document.getElementById('all_messages').className;
			if(all_messages=="all-messages has-unread open")
			all_messages="true"
			
			star=document.getElementById('starred_messages').className;
			if(star=="starred open")
			star="true";
			already_exists="false";
			var length=$('.projects-list').children('').length
			var open="false";
			var get_all_messages="false";
			var old_one="false";
			var exit1="false"
			for(i=0; i<length; i++)
			{
				var class1=$('.projects-list').children('')[i].className;
				if(class1=="project has-unread open" || class1=="project open")
				open="true"
				open_id=$('.projects-list').children('')[i].id;
				if(star=="true")
				{	
					if(key=="down" || key=="Z")
					already_exists=$('.projects-list').children('')[0].id;
					else if(exit1!="true" && (key=="up" || key=="A"))
					{
						window.location=$('#all_messages').attr('href');
						document.getElementById('all_messages').className="all-messages has-unread open";
						document.getElementById('starred_messages').className="starred";
						exit1="true"
					}
				}
				else if(open=="true" && i<length && (class1=="project has-unread open" || class1=="project open"))
				{
					if((key=="down" || key=="Z") && i<length-1)
					already_exists=$('.projects-list').children('')[i+1].id;
					else if(i!=0 && i<length && (key=="up" || key=="A"))
					already_exists=$('.projects-list').children('')[i-1].id;
					old_id=$('.projects-list').children('')[i].id;
					old_one="true";
					if(i==length-1)
					{
						document.getElementById(old_id).className="project";
					}
				}
				else
				{
				
					get_all_messages=="true"
				}
			}
			if(already_exists!="false")
			{
				//open_id=open_id.split('_')[2];
				//open_id=open_id.split('messages')[1];
					window.location=$('#'+already_exists).attr('href');
					is_open=$('#'+already_exists).children('.num-unread').length;
					if(is_open=="0")
					document.getElementById(already_exists).className="project open";
					else
					document.getElementById(already_exists).className="project has-unread open";
					
					if(old_one=="true")
					{
					is_open=$('#'+old_id).children('.num-unread').length;
					if(is_open=="0")
					document.getElementById(old_id).className="project";
					else
					document.getElementById(old_id).className="project has-unread";
					}
					else
								document.getElementById('starred_messages').className="starred";
			}
			else
			{
				if(all_messages=="true" && (key=="down" || key=="Z"))
				{
				
					window.location=$('.starred').attr('href');
					document.getElementById('starred_messages').className="starred open";
					document.getElementById('all_messages').className="all-messages has-unread";
				}
				else if(all_messages=="true" && (key=="up" || key=="A") && star!="true")
				{
				/*	first=$('.projects-list').children('')[length-1].id;
					window.location=$('#'+first).attr('href');
					is_open=$('#'+first).children('.num-unread').length;
					if(is_open=="0")
					document.getElementById(first).className="project open";
					else
					document.getElementById(first).className="project has-unread open";
					document.getElementById('all_messages').className="all-messages has-unread"; */
				}
				else if(open=="true" && (key=="down" || key=="Z"))
				{
					/* window.location=$('#all_messages').attr('href');
					document.getElementById('all_messages').className="all-messages has-unread open"; */
					first=$('.projects-list').children('')[length-1].id;
					document.getElementById(first).className="project open";
					}

				else if((open=="true" && (key=="up" || key=="A") && exit1=="false"))
				{
				
					window.location=$('.starred').attr('href');
					document.getElementById('starred_messages').className="starred open";
					first=$('.projects-list').children('')[0].id;
					is_open=$('#'+first).children('.num-unread').length;
if(is_open=="0")
					document.getElementById(first).className="project";
					else
					document.getElementById(first).className="project has-unread";
				}
				else if(star=="true")
				{
					//	window.location=$('#project_list_messages'+open_id).attr('href');
				}
				else if(key!="X" && key!="S")
				{
					window.location=$('#all_messages').attr('href');
					document.getElementById('all_messages').className="all-messages has-unread open";
					
				}
			}
		}
					setTimeout("messages_navigation_right()", 1000);
		}
		else
		{
		messages_second_panel_navigation(key);
		}
		}
		
		//for messages navigation right arrow
		function messages_navigation_right()
		{
		
		  var already_exists="false"
			var length=$('#message_area').children('').length;
			var exit="false";
			for(i=0; i<length; i++)
			{
				var firstclass=$('#message_area').children('')[i].className;
				if(firstclass!="date-bar" && exit=="false")
				{
					already_exists=$('#message_area').children('')[i].id;
					already_exists=already_exists.split('msac')[1];
					a=window.location.href;
					a=a.search('/'+already_exists);
					
					loc=window.location.href.split(already_exists)[0];
					
					if(a==-1)
					window.location=loc+"/"+already_exists;
					else
					window.location=loc+already_exists;
					$('#comment_area').show();

					$('#message_expand').show();
					exit="true"
					$('#message_area').children('')[i].className="message messow  mpi2 open";
					show_header();
				}
			}
		}
		
		//for messages navigation left arrow
		function messages_navigation_left()
		{
		var length=$('#message_area').children('').length;
			exit="false";
			for(i=0; i<length; i++)
			{
				firstclass=$('#message_area').children('')[i].className;
				if(firstclass=="message messow  mpi2 open")
				{
					$('#message_area').children('')[i].className="message messow  mpi2";
				}
			}
			$('#comment_area').hide();
			$('#message_expand').hide();
					$('.message_header').hide();
		}
		
		//for messages second panel navigation
		function messages_second_panel_navigation(key)
		{
		
		if(key=="D" || key=="C")
		messages_third_panel(key);
		else
		{
			  already_exists="false"
				exit="false";
			var length=$('#message_area').children('').length;
			
			for(i=0; i<length; i++)
			{
			
				var firstclass=$('#message_area').children('')[i].className;
				var f=firstclass.search('open')
				if(f!=-1)
				{
				var is_there=typeof($('#message_area').children('')[i+1])=="undefined"
				if(is_there==true)
				already_exists=$('#message_area').children('')[i-1].className;
				else
					already_exists=$('#message_area').children('')[i+1].className;
					
					
					if(already_exists!="date-bar" && exit=="false" && (key=="down" || key=="X"))
					{
						already_exists=$('#message_area').children('')[i+1].id;
						already_exists=already_exists.split('msac')[1];
						exists=$('#message_area').children('')[i].id;
						exists=exists.split('msac')[1];
						var a_firstclass=$('#message_area').children('')[i+1].className;
						var b_firstclass=$('#message_area').children('')[i].className;
						
						loc=window.location.href.split(exists)[0];
						window.location=loc+already_exists;
						loc="";
						$('#message_area').children('')[i+1].className=b_firstclass;
						a=$('#message_area').children('')[i].className
						if(a=="date-bar")
						$('#message_area').children('')[i-1].className=a_firstclass;
						else
						$('#message_area').children('')[i].className=a_firstclass;
						exit="true"
					}
					else if(exit=="false" && (key=="down" || key=="X"))
					{
					already_exists=$('#message_area').children('')[i+2].id;
						already_exists=already_exists.split('msac')[1];
						exists=$('#message_area').children('')[i].id;
						exists=exists.split('msac')[1];
							var a_firstclass=$('#message_area').children('')[i+2].className;
						var b_firstclass=$('#message_area').children('')[i].className;
						loc=window.location.href.split(exists)[0];
						window.location=loc+already_exists;
						loc="";
						$('#message_area').children('')[i+2].className=b_firstclass;
						a=$('#message_area').children('')[i].className
						if(a=="date-bar")
						$('#message_area').children('')[i-2].className=a_firstclass;
						else
						$('#message_area').children('')[i].className=a_firstclass;
						exit="true"
					}
					if(key=="up" || key=="S")
					{
					already_exists=$('#message_area').children('')[i-1].className;
					 if(already_exists!="date-bar" && exit=="false")
					{
						already_exists=$('#message_area').children('')[i-1].id;
						already_exists=already_exists.split('msac')[1];
						exists=$('#message_area').children('')[i].id;
						exists=exists.split('msac')[1];
							var a_firstclass=$('#message_area').children('')[i-1].className;
						var b_firstclass=$('#message_area').children('')[i].className;
						loc=window.location.href.split(exists)[0];
						window.location=loc+already_exists;
						loc="";
						$('#message_area').children('')[i-1].className=b_firstclass;
						a=$('#message_area').children('')[i].className
						if(a=="date-bar")
						$('#message_area').children('')[i+1].className=a_firstclass;
						else
						$('#message_area').children('')[i].className=a_firstclass;
						exit="true"
					}
					else if(exit=="false")
					{
				//	var is_there=typeof($('#message_area').children('')[i-2])=="undefined"

					already_exists=$('#message_area').children('')[i-2].id;
						already_exists=already_exists.split('msac')[1];
						exists=$('#message_area').children('')[i].id;
						exists=exists.split('msac')[1];
							var a_firstclass=$('#message_area').children('')[i-2].className;
						var b_firstclass=$('#message_area').children('')[i].className;
						loc=window.location.href.split(exists)[0];
						window.location=loc+already_exists;
						loc="";
						$('#message_area').children('')[i-2].className=b_firstclass;
						a=$('#message_area').children('')[i].className
						if(a=="date-bar")
						$('#message_area').children('')[i+2].className=a_firstclass;
						else
						$('#message_area').children('')[i].className=a_firstclass;
						exit="true"
					}
					}
				}
			}
		}
		}
		
		//for displaying the message header
		function show_header()
		{

		$('.message_header').show();
		
		}
		
		function tasks_navigation_down(key)
		{
		var class1=$('#comment_area').children('').length;
			var class_hide=$('#comment_area').css('display');
			var project="true";
			
			if((class1==0 || class_hide=="none") || (key=="A" || key=="Z"))
			{
			  if(key=="A" || key=="Z")
				{
					tasks_navigation_left();
				}
				if (key=="S" || key=="X")
			 {
				 			setTimeout("tasks_navigation_right()", 1500);
			 }
			 else
			 {
				var all_tasks=document.getElementById('all_tasks').className;
				var my_tasks=document.getElementById('my_tasks').className;
				var starred_tasks=document.getElementById('starred_tasks').className;
				var completed_tasks=document.getElementById('completed_tasks').className;
				var project_tasks="project_tasks";
				var pl=$('.projects-list').children().length;
				for(i=0; i<pl; i++)
				{
					var cn=$('.projects-list').children()[i].className;
					if(cn=="project open")
					{
						project_tasks=cn;
					}
				}
				if(all_tasks=="all-tasks open") // to open my_tasks from all_tasks(down)
				{
				  if(key=="down" || key=="Z")
					{
						window.location.hash="#my_tasks";
						document.getElementById('my_tasks').className="my-tasks open";
								
					}
					else
					{
							//tasks_projects(key, "1")
					}					
					document.getElementById('all_tasks').className="all-tasks";
					project="false";
				}
				else if(my_tasks=="my-tasks open") // from my_tasks to starred_tasks
				{
					if(key=="down" || key=="Z") //down
					{
						window.location.hash="#starred_tasks";
						document.getElementById('starred_tasks').className="starred starred_count open";
					}
					else //up
					{
					window.location.hash="#all_tasks";
					document.getElementById('all_tasks').className="all-tasks open";
					}
					document.getElementById('my_tasks').className="my-tasks";
					project="false";
				}
				else if(starred_tasks=="starred starred_count open") // from starred_tasks to completed_tasks
				{
				  if(key=="down" || key=="Z") //down
					{
						window.location.hash="#completed_tasks";
						document.getElementById('completed_tasks').className="completed open";
					}
					else //up
					{
					window.location.hash="#my_tasks";
					document.getElementById('my_tasks').className="my-tasks open";
					}
					document.getElementById('starred_tasks').className="starred starred_count";
					project="false";
				}
				else if(completed_tasks=="completed open")
				{
					if(key=="down" || key=="Z")
					tasks_projects(key,"2");
					else
					{
						window.location.hash="#starred_tasks";
						document.getElementById('starred_tasks').className="starred starred_count open";
					}
					document.getElementById('completed_tasks').className="completed";
					project="false";
				}
				else
				{
				
				if(all_tasks=="all-tasks" && my_tasks=="my-tasks" && starred_tasks=="starred starred_count" && completed_tasks=="completed" && project_tasks=="project_tasks")
				{
				window.location.hash="#all_tasks";
						document.getElementById('all_tasks').className="all-tasks open";
				}
				else
				  tasks_projects(key,"3");
				}
			}
			setTimeout("tasks_navigation_right()", 1000);
			
			}
			else
			{
			
			if(key=="D" || key=="C")
			{
				messages_third_panel(key);
			}
			else
			{
				var task_length=$('.m-panel').children().length;
				var stop="false";
				for(i=0; i<task_length; i++)
				{	
					var task=$('.m-panel').children()[i].className;
					
					if(task!="sub-header" && (key=="down" || key=="up" || key=="S" || key=="X"))
					{
					
					var task_id=task.split("actk:")[1];
						task_id=task_id.split(" task")[0];
					
					
						
						if(((task=="actk:"+task_id+" task tsem open" && stop=="false") || (task=="actk:"+task_id+" task tsem  open" && stop=="false") || (task=="actk:"+task_id+" task tsem starred open" && stop=="false")) || ((task=="actk:"+task_id+" task alt tsem open" && stop=="false") || (task=="actk:"+task_id+" task alt tsem  open" && stop=="false") || (task=="actk:"+task_id+" task alt tsem starred open" && stop=="false")))
						{
						  if(key=="down" || key=="X")
							var move_task=$('.m-panel').children()[i+1].className;
							else
							var move_task=$('.m-panel').children()[i-1].className;
							if(move_task=="sub-header")
							if(key=="down" || key=="X")
							move_task=$('.m-panel').children()[i+2].className;
							else
							move_task=$('.m-panel').children()[i-2].className;
							move_task_id=move_task.split("actk:")[1];
							move_task_id=move_task_id.split(" task")[0];
							var b=window.location.href;
							b=b.split("<%= APP_CONFIG[:site_url] %>/")[1];
							b=b.split("/")
							var c=b.length;
							if(c=="2")
							var d=b[0];
							else
							var d=b[0]+b[1];
							
							window.location.href=d+"/"+move_task_id;
							var a=document.getElementById("tk_"+move_task_id).className;
							var aa=document.getElementById("tk_"+task_id).className;
							aa=aa.split(" open")[0];
							document.getElementById("tk_"+move_task_id).className=a+" open";
							document.getElementById("tk_"+task_id).className=aa;
							$('#comment_area').show();
							$('.task_header').show();
							stop="true";
						}
					}
				}
			}	
				
				
				
				
				
				
				
				
			}	
		}
		function tasks_projects(key,pid) //first_panel
		{
		 var project_length=$('.projects-list').children().length;
		 var stop="false";
		 var project1="false";
		 if(pid=="2")
		 {
						var child=$('.projects-list').children()[0].id;
						child=child.split('tpi')[1];
						stop="true"
							project="true";
						window.location.hash="#"+child;
						$('.projects-list').children()[0].className="project open";
						document.getElementById('completed_tasks').className="completed";
					
		 }
			if(pid=="1")
		 {
						var child=$('.projects-list').children()[project_length-1].id;
						child=child.split('tpi')[1];
						stop="true"
						project1="true";
						window.location.hash="#"+child;
						$('.projects-list').children()[project_length-1].className="project open";
						document.getElementById('all_tasks').className="all-tasks";
		 }
		 for(i=0; i<project_length; i++)
		 {
				var cn=$('.projects-list').children()[i].className;
				if(cn=="project open" && stop=="false" && (key=="down" || key=="Z"))
				{
					if(i<project_length-1)
					{
						var child=$('.projects-list').children('')[i+1].id;
						child=child.split('tpi')[1];
						$('.projects-list').children()[i].className="project";
						$('.projects-list').children()[i+1].className="project open";
						stop="true"
						project="true";
						window.location.hash="#"+child;
					}
					else if(key=="down" || key=="Z")
					{
					//	window.location.hash="#all_tasks";
					//	document.getElementById('all_tasks').className="all-tasks open";
//						$('.projects-list').children()[i].className="project";
					}
					
				}
				else if(cn=="project open" && stop=="false" && (key=="up" || key=="A"))
				{
					if(i>0)
					{
						var child=$('.projects-list').children('')[i-1].id;
						child=child.split('tpi')[1];
						$('.projects-list').children()[i].className="project";
						$('.projects-list').children()[i-1].className="project open";
						stop="true";
						project="true";
						window.location.hash="#"+child;
					}
					else if(key=="up" || key=="A")
					{
						var child=$('.projects-list').children()[0].className="project";
						stop="true"
						project="true";
						window.location.hash="#completed_tasks";
						document.getElementById('completed_tasks').className="completed open";
					}
					
				}
				else if(pid !="2" && project1=="false")
				{
				//alert(project1);
					//	window.location.hash="#all_tasks";
					//	document.getElementById('all_tasks').className="all-tasks open";
				}
		 }
		}
		
		function tasks_navigation_right()
		{
		//alert("dssd");
			var task_length=$('.m-panel').children().length;
			var stop="false";
			for(i=0; i<task_length; i++)
			{
				var task=$('.m-panel').children()[1].className;
				var task_id=task.split("actk:")[1];
				task_id=task_id.split(" task")[0];
				
				if(task!="sub-header" && stop=="false")
				{
				  b=window.location.href;
					
					b=b.split("<%= APP_CONFIG[:site_url] %>/")[1];
					
					
					if(b.search("/")!=-1)
					{
					$('.task_header').show();
			$('#comment_area').show();
					var a=document.getElementById("tk_"+task_id).className;
					document.getElementById("tk_"+task_id).className=a+" open";
					}
					else
					{
					var comment_area=$('#comment_area').css('display');
					
					window.location.hash=window.location.hash+"/"+task_id;
											$('#comment_area').show();
						$('.task_header').show();
					var a=document.getElementById("tk_"+task_id).className;
					if(comment_area=="none")
					{
					
					document.getElementById("tk_"+task_id).className=a+" open";
					}
						$('#comment_area').show();
						$('.task_header').show();
					}
					stop="true";
				}
			}
			
		}
		
		function tasks_navigation_left()
		{
			var task_length=$('.m-panel').children().length;
			for(i=0; i<task_length; i++)
			{
				var task=$('.m-panel').children()[i].className;
				
				
				if(task!="sub-header")
				{
				var task_id=task.split("actk:")[1];
				task_id=task_id.split(" task")[0];
					var a=document.getElementById("tk_"+task_id).className;
					a=a.split(" open")[0];
					
					document.getElementById("tk_"+task_id).className=a;
					$('#comment_area').hide();
					$('.task_header').hide();
					a=window.location.hash=window.location.hash;
					a=a.split("/"+task_id)[0];
					window.location.hash=a;
				}
			}
		}
		
		$('#all_tasks').live('click',function(){
			$('#select_task_starred').removeClass('selected');
			$('#select_task_ascending').addClass('selected');
       $('#select_task_date').addClass('selected');
			 $('#select_task_descending').removeClass('selected');
		});
		
		$('#my_tasks').live('click',function(){
		$('#select_task_starred').removeClass('selected');
		$('#select_task_ascending').addClass('selected');
    $('#select_task_date').addClass('selected');
		$('#select_task_descending').removeClass('selected');
		});
		
	 $('#completed_tasks').live('click',function(){
		$('#select_task_starred').removeClass('selected');
		$('#select_task_ascending').addClass('selected');
    $('#select_task_date').addClass('selected');
		$('#select_task_descending').removeClass('selected');
		});
		function messages_third_panel(key)
		{
			var comment_length=$('.prev-messages').children().length;
			var comment_open="false";
			for (i=0; i<comment_length; i++)
			{
				var comment=$('.prev-messages').children()[i].className;
				if (comment=="message message_comments   open")
				{
				 comment_open="true"
				 var comment_position=i;
				}
			}
			if(comment_open=="false")
			{
			  $('.prev-messages').children()[0].className="message message_comments   open";
			}
			else
			{
			  if(key=="C")
				{
					$('.prev-messages').children()[comment_position].className="message message_comments  ";
					$('.prev-messages').children()[comment_position+1].className="message message_comments   open";
				}
				else
				{
					$('.prev-messages').children()[comment_position].className="message message_comments  ";
					$('.prev-messages').children()[comment_position-1].className="message message_comments   open";
				}
			}
		}
function chats_navigation_down(key)
{
  var chat_length=$('.projects-list').children().length;
	var stop="false";
	for(var i=0; i<chat_length; i++)
	{
		var chat_class=$('.projects-list').children()[i].className;
		
		if(chat_class=="project open" && stop=="false")
		{
	  if(key=="down" || key=="Z")
		{

			var next_chat=$('.projects-list').children()[i+1].id;
			
			$('#'+next_chat).click();
			stop="true";
		}
		 else if(key=="up" || key=="A")
		{

			var next_chat=$('.projects-list').children()[i-1].id;
			
			$('#'+next_chat).click();
			stop="true";
		}
		}
	}
}
			
</script>

</html>

